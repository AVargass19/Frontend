export const colombiaData = {
    departamentos: [
        { id: 'BOG', nombre: 'Bogotá D.C.' },
        { id: 'ANT', nombre: 'Antioquia' },
        { id: 'ATL', nombre: 'Atlántico' },
        { id: 'BOL', nombre: 'Bolívar' },
        { id: 'BOY', nombre: 'Boyacá' },
        { id: 'CAL', nombre: 'Caldas' },
        { id: 'CAQ', nombre: 'Caquetá' },
        { id: 'CAU', nombre: 'Cauca' },
        { id: 'CES', nombre: 'Cesar' },
        { id: 'COR', nombre: 'Córdoba' },
        { id: 'CUN', nombre: 'Cundinamarca' },
        { id: 'CHO', nombre: 'Chocó' },
        { id: 'HUI', nombre: 'Huila' },
        { id: 'LAG', nombre: 'La Guajira' },
        { id: 'MAG', nombre: 'Magdalena' },
        { id: 'MET', nombre: 'Meta' },
        { id: 'NAR', nombre: 'Nariño' },
        { id: 'NSA', nombre: 'Norte de Santander' },
        { id: 'QUI', nombre: 'Quindío' },
        { id: 'RIS', nombre: 'Risaralda' },
        { id: 'SAN', nombre: 'Santander' },
        { id: 'SUC', nombre: 'Sucre' },
        { id: 'TOL', nombre: 'Tolima' },
        { id: 'VAC', nombre: 'Valle del Cauca' },
        { id: 'ARA', nombre: 'Arauca' },
        { id: 'CAS', nombre: 'Casanare' },
        { id: 'PUT', nombre: 'Putumayo' },
        { id: 'SAP', nombre: 'San Andrés y Providencia' },
        { id: 'AMA', nombre: 'Amazonas' },
        { id: 'GUA', nombre: 'Guainía' },
        { id: 'GUV', nombre: 'Guaviare' },
        { id: 'VAU', nombre: 'Vaupés' },
        { id: 'VID', nombre: 'Vichada' }
    ],
    
    ciudades: {
        'BOG': ['Bogotá'],
        'ANT': ['Medellín', 'Bello', 'Envigado', 'Itagüí', 'Rionegro', 'Apartadó', 'Turbo', 'Caucasia', 'La Estrella', 'Marinilla'],
        'ATL': ['Barranquilla', 'Soledad', 'Malambo', 'Puerto Colombia', 'Galapa', 'Sabanalarga', 'Baranoa', 'Santo Tomás'],
        'BOL': ['Cartagena', 'Magangué', 'El Carmen de Bolívar', 'Turbaco', 'Arjona', 'San Juan Nepomuceno', 'Santa Rosa del Sur'],
        'BOY': ['Tunja', 'Duitama', 'Sogamoso', 'Chiquinquirá', 'Paipa', 'Puerto Boyacá', 'Moniquirá', 'Villa de Leyva'],
        'CAL': ['Manizales', 'La Dorada', 'Chinchiná', 'Villamaría', 'Anserma', 'Riosucio', 'Manzanares'],
        'CAQ': ['Florencia', 'San Vicente del Caguán', 'Puerto Rico', 'El Doncello', 'Cartagena del Chairá'],
        'CAU': ['Popayán', 'Santander de Quilichao', 'Puerto Tejada', 'Patía', 'Miranda', 'Caloto', 'Timbío'],
        'CES': ['Valledupar', 'Aguachica', 'Agustín Codazzi', 'La Paz', 'Bosconia', 'El Copey', 'San Alberto'],
        'COR': ['Montería', 'Lorica', 'Cereté', 'Sahagún', 'Planeta Rica', 'Montelíbano', 'Tierralta'],
        'CUN': ['Soacha', 'Facatativá', 'Zipaquirá', 'Chía', 'Mosquera', 'Madrid', 'Funza', 'Cajicá', 'Girardot', 'Ubaté'],
        'CHO': ['Quibdó', 'Istmina', 'Tadó', 'Bahía Solano', 'Nuquí', 'Alto Baudó', 'Medio Atrato'],
        'HUI': ['Neiva', 'Pitalito', 'Garzón', 'La Plata', 'Campoalegre', 'Gigante', 'Palermo', 'Aipe'],
        'LAG': ['Riohacha', 'Maicao', 'Uribia', 'Manaure', 'San Juan del Cesar', 'Villanueva', 'Dibulla'],
        'MAG': ['Santa Marta', 'Ciénaga', 'Fundación', 'Aracataca', 'El Banco', 'Zona Bananera', 'Plato'],
        'MET': ['Villavicencio', 'Acacías', 'Granada', 'Puerto López', 'San Martín', 'Restrepo', 'Cumaral'],
        'NAR': ['Pasto', 'Tumaco', 'Ipiales', 'La Unión', 'Túquerres', 'Samaniego', 'Sandoná'],
        'NSA': ['Cúcuta', 'Ocaña', 'Villa del Rosario', 'Los Patios', 'Pamplona', 'Tibú', 'El Zulia'],
        'QUI': ['Armenia', 'Calarcá', 'Montenegro', 'Quimbaya', 'La Tebaida', 'Circasia', 'Filandia'],
        'RIS': ['Pereira', 'Dosquebradas', 'Santa Rosa de Cabal', 'La Virginia', 'Belén de Umbría', 'Quinchía'],
        'SAN': ['Bucaramanga', 'Floridablanca', 'Girón', 'Piedecuesta', 'Barrancabermeja', 'San Gil', 'Socorro'],
        'SUC': ['Sincelejo', 'Corozal', 'San Marcos', 'San Onofre', 'Tolú', 'Sampués', 'San Luis de Sincé'],
        'TOL': ['Ibagué', 'Espinal', 'Melgar', 'Chaparral', 'Mariquita', 'Honda', 'Líbano', 'Flandes'],
        'VAC': ['Cali', 'Buenaventura', 'Palmira', 'Tuluá', 'Yumbo', 'Jamundí', 'Cartago', 'Buga'],
        'ARA': ['Arauca', 'Saravena', 'Tame', 'Fortul', 'Arauquita', 'Puerto Rondón', 'Cravo Norte'],
        'CAS': ['Yopal', 'Aguazul', 'Villanueva', 'Paz de Ariporo', 'Tauramena', 'Monterrey', 'Maní'],
        'PUT': ['Mocoa', 'Puerto Asís', 'Orito', 'Valle del Guamuez', 'Puerto Guzmán', 'Villagarzón'],
        'SAP': ['San Andrés', 'Providencia'],
        'AMA': ['Leticia', 'Puerto Nariño'],
        'GUA': ['Inírida', 'Barrancominas', 'Mapiripana', 'San Felipe', 'Puerto Colombia'],
        'GUV': ['San José del Guaviare', 'Calamar', 'El Retorno', 'Miraflores'],
        'VAU': ['Mitú', 'Carurú', 'Taraira', 'Pacoa', 'Yavaraté'],
        'VID': ['Puerto Carreño', 'La Primavera', 'Santa Rosalía', 'Cumaribo']
    }
};

export const initLocationSelectors = () => {
    console.log('Iniciando selectores de ubicación...'); 

    const departamentoSelect = document.getElementById('departamento');
    const municipioInput = document.getElementById('municipio');
    const municipioDatalist = document.getElementById('municipios-list');

    if (!departamentoSelect || !municipioInput || !municipioDatalist) {
        console.error('No se encontraron elementos necesarios:', {
            departamentoSelect: !!departamentoSelect,
            municipioInput: !!municipioInput,
            municipioDatalist: !!municipioDatalist
        });
        return;
    }

    console.log('Poblando departamentos...'); 
    const departamentosOptions = colombiaData.departamentos
        .map(depto => `<option value="${depto.nombre}">${depto.nombre}</option>`)
        .join('');
    departamentoSelect.innerHTML = '<option value="" selected disabled>Selecciona un departamento...</option>' + departamentosOptions;

    departamentoSelect.addEventListener('change', function() {
        console.log('Departamento seleccionado:', this.value); 
        const deptoSeleccionado = colombiaData.departamentos.find(d => d.nombre === this.value);
        
        if (deptoSeleccionado) {
            const ciudades = colombiaData.ciudades[deptoSeleccionado.id] || [];
            console.log('Ciudades disponibles:', ciudades); 
            
            municipioDatalist.innerHTML = ciudades
                .map(ciudad => `<option value="${ciudad}">`)
                .join('');

            municipioInput.value = '';
            
            document.dispatchEvent(new CustomEvent('shipping-location-changed', {
                detail: { departamento: this.value }
            }));
        }
    });

    municipioInput.addEventListener('input', function() {
        const deptoSeleccionado = colombiaData.departamentos.find(d => 
            d.nombre === departamentoSelect.value);
        
        if (deptoSeleccionado && this.value) {
            const ciudades = colombiaData.ciudades[deptoSeleccionado.id] || [];
            const ciudadesFiltradas = ciudades.filter(ciudad => 
                ciudad.toLowerCase().includes(this.value.toLowerCase())
            );
            
            console.log('Filtrado de ciudades:', {
                input: this.value,
                coincidencias: ciudadesFiltradas
            }); 

            municipioDatalist.innerHTML = ciudadesFiltradas
                .map(ciudad => `<option value="${ciudad}">`)
                .join('');
        }
    });
};

document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM Cargado - Iniciando location selectors'); 
    initLocationSelectors();
});